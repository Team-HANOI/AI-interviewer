<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team.interview.dao.QuestionDAO">

	<select id="backQuestion" resultType="QuestionVO">
	<![CDATA[
		SELECT q_id as "qId",content FROM(
		    		SELECT q_id ,content 
		    		FROM TBL_Q
		    		WHERE q_type='icebreaking'
		   			ORDER BY DBMS_RANDOM.RANDOM
		   		 )   		 
		   	 WHERE rownum < 3 UNION SELECT * FROM(
		    		SELECT q_id ,content
		    		FROM TBL_Q 
		    		WHERE q_type ='cs'
		   			ORDER BY DBMS_RANDOM.RANDOM
		   		 )	 
		   	 WHERE rownum < 3 UNION SELECT * FROM(
		    		SELECT q_id ,content
		    		FROM TBL_Q 
		    		WHERE q_type='백엔드'
		   			ORDER BY DBMS_RANDOM.RANDOM
		   		 )
		 WHERE rownum < 3
		]]>
	</select>

	<select id="frontQuestion" resultType="QuestionVO">
	<![CDATA[
		SELECT * FROM(
		    		SELECT CONTENT,ssml
		    		FROM TBL_Q
		    		WHERE q_type='icebreaking'
		   			ORDER BY DBMS_RANDOM.RANDOM
		   		 )   		 
		   	 WHERE rownum < 3 UNION SELECT * FROM(
		    		SELECT CONTENT,ssml
		    		FROM TBL_Q 
		    		WHERE q_type ='cs'
		   			ORDER BY DBMS_RANDOM.RANDOM
		   		 )	 
		   	 WHERE rownum < 3 UNION SELECT * FROM(
		    		SELECT CONTENT,ssml
		    		FROM TBL_Q 
		    		WHERE q_type='프론트엔드'
		   			ORDER BY DBMS_RANDOM.RANDOM
		   		 )
		 WHERE rownum < 3
		]]>
	</select>

	<!-- 전체질문 목록 추천수 10이상만 보이게 해야하는데... -->
	<select id="SelectAllQList" resultType="QuestionVO"
		parameterType="int">
<![CDATA[
	   		select q_id as qid,content
		from (select row_number() over (order by q_id_sq desc) num, A.* from tbl_qh A order by q_id_sq desc) 
		where num between #{startrow} and #{startrow}+10 and r_cnt>10
		]]>

	</select>
	<select id="selectAllQCount" resultType="int">
		<![CDATA[
		select count(*) from tbl_qh
		]]>

	</select>
	<select id="selectAllACount" resultType="int">
	<![CDATA[
		select count(*) from tbl_answerh
		]]>
	</select>

	<select id="Querykw" resultType="QuestionVO">
		<![CDATA[
	select q_id as qid,content from (select row_number() over (order by q_id_sq desc) num, A.* from tbl_q A order by q_id_sq desc)
		where KW_LIST like '%'||#{kw}||'%' and num between #{startrow} and #{startrow}+10 and r_cnt>=10
		]]>
	</select>

	<update id="UpdateRCnt">
	<![CDATA[
		update tbl_answerh set r_cnt=r_cnt+1 where answer_id=#{answerId}
		]]>

	</update>

	<select id="QueryRCnt" parameterType="int" resultType="int">
	<![CDATA[
		select r_cnt as rCnt from tbl_answerh where answer_id=#{answerId}
	]]>
	</select>


	<select id="SelectProfile" resultType="ProfileVO"
		parameterType="int">
	<![CDATA[
		select p.pf_img_id as pfImgId, m.name as name from tbl_i_recordh r, tbl_memberh m, tbl_profileh p
		where r.email=m.email and m.pf_id=p.pf_id and r.i_record_id=#{iRecordId}
		]]>
	</select>

	<select id="SelectAnswer" resultType="AnswerVO">
	<![CDATA[
		select answer_id as answerId,content, i_record_id as iRecordId,r_cnt as rCnt, regdate
		 from (select row_number() over (order by a_id_sq desc) num, A.* from tbl_answerh A order by a_id_sq desc) 
		where q_id=#{q_id} and num between #{startrow} and #{startrow}+10 
		]]>
	</select>
	
	<select id="SelectAnswerRCnt" resultType="AnswerVO">
	<![CDATA[
		select answer_id as answerId,content, i_record_id as iRecordId,r_cnt as rCnt, regdate
		 from (select row_number() over (order by r_cnt desc) num, A.* from tbl_answerh A order by r_cnt desc) 
		where q_id=#{q_id} and num between #{startrow} and #{startrow}+10 
		]]>
	</select>


	<select id="getFile" parameterType="int" resultType="fileVO">
	<![CDATA[
	select 
	pf_img_id as "fileId",
	file_name as "fileName",
	file_size as "fileSize",
	file_content_type as "fileContentType",
	file_data as "fileData"
	from tbl_pf_imgh
	where pf_img_id=#{fileId}
	]]>

	</select>


</mapper>