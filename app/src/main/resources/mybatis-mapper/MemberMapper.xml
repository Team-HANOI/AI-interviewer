<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.alpaca.app.sample.mapper.MemberMapper">

    <resultMap type="com.alpaca.app.sample.domain.MemberVO" id="memberMap">
        <id property="email" column="email"/>
        <result property="email" column="email"/>
        <result property="pfId" column="pfId"/>
        <result property="pw" column="pw"/>
        <result property="name" column="name"/>
        <result property="enabled" column="enabled"/>
        <result property="phoneNum" column="phone_num"/>
<!--        <result property="type" column="type"/>-->
        <result property="lockdate" column="lockdate"/>
        <result property="failureCnt" column="failure_cnt"/>
        <result property="regdate" column="regdate"/>
        <result property="updatedate" column="updatedate"/>
        <result property="fromSocial" column="from_social"/>
        <collection property="roleSet" resultMap="authMap">
        </collection>
    </resultMap>

    <resultMap type="com.alpaca.app.sample.domain.AuthVO" id="authMap">
        <result property="auth" column="auth"/>
    </resultMap>


    <insert id="saveMember" parameterType="com.alpaca.app.sample.domain.MemberVO">
        <![CDATA[
        INSERT
        INTO
            tbl_member
        (
            email
            , name
            , pw
            , from_social
        )
        VALUES
            (   #{email}
                ,#{name}
                ,#{pw}
                ,#{fromSocial}
            )
        ]]>
    </insert>

    <select id="findByEmail" resultMap = "memberMap">
      <![CDATA[
        SELECT
            mem.email
             , pf_id
             , pw
             , name
             , regdate
             , updatedate
             , enabled
             , from_social
             , phone_num
             , lockdate
             , failure_cnt
             , auth.auth
        FROM
            tbl_member mem
                LEFT OUTER JOIN
            tbl_auth auth
            on mem.email = auth.email
        WHERE mem.email = #{email} and from_social = #{fromSocial}
        ]]>
    </select>
</mapper>